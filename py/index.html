<!DOCTYPE html><html lang="zh-cn" theme-mode="auto"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>用pillow有感 | wsd's Blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light' || window.matchMedia('(prefers-color-scheme:light)').matches) document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark' || window.matchMedia('(prefers-color-scheme:dark)').matches) document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">主页</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">目录</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">关于</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>用pillow有感</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-08-25T10:53:27.000Z" id="date"> 2023-08-25</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-08-25T12:14:03.798Z" id="updated"> 2023-08-25</time></div></span><br><span>文章总字数: <div class="control">1.1k</div></span></div></div><hr><div id="post-content"><p>简单说一下写phigros插件的经历<del>以及我的M倾向嫌疑</del></p>
<span id="more"></span>

<h1 id="不要没事找事。"><a href="#不要没事找事。" class="headerlink" title="不要没事找事。"></a>不要没事找事。</h1><p><del>捏吗的对坐标快对吐了</del></p>
<h2 id="M属性大爆发"><a href="#M属性大爆发" class="headerlink" title="M属性大爆发"></a>M属性大爆发</h2><p>暑假快结束了,由于实在没啥干这几天快被闲死了<br>除了打打ba占领战就是看看视频了<br>直到前几天有群友拉我打l4d2,而我显然是还处于电子阳痿状态,摸了没一个小时就摆了</p>
<p>那天上午，我在逛github找找有没有好玩的项目，看到了<code>PhigrosLibrary</code>这么个东西然后发到了萝卜洞。<br>结果当天晚上从l4d2退出来就开始<del>爆发M属性</del>写这玩意了</p>
<p>我还想着随便摸个能用就行的东西，大不了学学amilyia bot直接返回黑底白字就当查分了，速度还快。<br>结果我这脑子怎么就非得整个图形化呢<br>然后被PIL折磨致死。</p>
<h2 id="初步构思"><a href="#初步构思" class="headerlink" title="初步构思"></a>初步构思</h2><p>我不是主玩臀的(至少从两年前到现在是这样),查臀对我来说的意义不是很大,所以一直没整这东西.<br>我的设想是整个b19查询图及一个用户信息查询图，以及绑定和解绑<br>这些对我来说就够用了<del>(因为维护起来好麻烦)</del>。</p>
<h2 id="从python折磨到photoshop再折磨到python"><a href="#从python折磨到photoshop再折磨到python" class="headerlink" title="从python折磨到photoshop再折磨到python"></a>从python折磨到photoshop再折磨到python</h2><h4 id="指令处理部分"><a href="#指令处理部分" class="headerlink" title="指令处理部分"></a>指令处理部分</h4><p>先写了一个对指令进行处理的__init__.py，以及一个负责让我调用api查询的requests.py<br>在测试过没问题之后就开始数据库处理部分，我用的是totroise OEM进行连接和查询，还是比较方便的</p>
<p>这部分确实简单<br>与后面两个相比省事的多。</p>
<h4 id="photoshop设计部分"><a href="#photoshop设计部分" class="headerlink" title="photoshop设计部分"></a>photoshop设计部分</h4><p>好好好我知道我UI画的贼丑<br>别骂了别骂了呜呜呜</p>
<p>b19我仿着phi-plugin画的，info则是从游戏里截图然后硬补<br>这部分确实挺折磨人的，看看生成的图你们大概也能猜到<br>花的时间差不多7+h</p>
<h4 id="PIL绘图部分"><a href="#PIL绘图部分" class="headerlink" title="PIL绘图部分"></a>PIL绘图部分</h4><p>你看我像用过pillow的人吗。<br>好在这东西还算好上手，加上有new bing的协助很快就知道了一些基本操作。<br>但是最痛苦的事情是<strong>对坐标</strong>。<br>我只能又拿出来photoshop挨个看坐标然后边看边写<br>花的时间差不多9+h</p>
<p>之后我就拉出来了个这.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image, ImageDraw, ImageFont, ImageFilter<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">导入这些就够用了</span><br><span class="hljs-string">PIL四个 导入图片 粘贴图片 绘制文字 处理图片(我拿来加高斯模糊)</span><br><span class="hljs-string">asyncio 你猜我写成异步干什么</span><br><span class="hljs-string">uuid 生成图片文件名</span><br><span class="hljs-string">os 读取文件用得到</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>...<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserinfoRender</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;用户信息生成类&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, ...</span>):<br>        ...<br>        self.draw = <span class="hljs-literal">None</span><br>        self.backgroud = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">try</span>:    <br>            <span class="hljs-comment"># 新建图像</span><br>            self.backgroud = Image.new(<span class="hljs-string">&#x27;RGBA&#x27;</span>, (<span class="hljs-number">2048</span>, <span class="hljs-number">1080</span>), color=(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))<br>            self.draw = ImageDraw.Draw(self.backgroud)<br>            <span class="hljs-comment"># 调用函数完成绘制</span><br>            <span class="hljs-keyword">await</span> self.draw_bg()<br>            <span class="hljs-keyword">await</span> asyncio.gather(*[<br>                self.draw_user(),<br>                ...<br>            ])<br>            <span class="hljs-comment"># 保存图像并返回绝对路径</span><br>            file = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;PATH&#125;</span>/.../temp/<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(uuid.uuid4())&#125;</span>.png&quot;</span><br>            self.backgroud.save(file)<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;file&quot;</span>: file&#125;<br>        <span class="hljs-keyword">except</span>:<br>            ...<br>    <br>    ...<br><br>...<br></code></pre></td></tr></table></figure>
<p>好好好我知道我写的一坨，但对我来说它能用就够了。</p>
<h2 id="永无止境的折磨"><a href="#永无止境的折磨" class="headerlink" title="永无止境的折磨"></a>永无止境的折磨</h2><p>这当然是实现了部分我的设想，但是还是存在一些问题，或许也有人发现了<br>比如，绘制出来的图是带点透明的，这个我当然发现了，复现也很简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">backgroud = Image.new(<span class="hljs-string">&#x27;RGBA&#x27;</span>, (x, y), color=(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))<br>img = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;PATH&#125;</span>/.../image.png&#x27;</span>)<br>backgroud.paste(img, (x,y), img)<br></code></pre></td></tr></table></figure>
<p>如果image.png带有alpha通道，而且有部分是半透明的，那么将这张图片粘贴到background上以后，image.png半透明的部分在background上也会变成半透明<br>目前我并不知道解决方法，如果有还请联系我</p>
<p>除了上面的b19跟info以外我还画了俩饼(查曲目信息<del>和查单曲分数</del>(似乎实现不了了))，但主播马上开学所以不整了<br>而且主播也不是主玩phi的，<del>能用就行</del>有空再说<br>以下是这玩意目前的目录结构</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">phigros<br>├─database<br>│   ├─__init__.py  <br>│   ├─db.py<br>│   └─models.py<br>├─imgdraw<br>│   ├─__init__.py<br>│   ├─b19.py<br>│   ├─info.py<br>│   └─utils.py<br>├─__init__.py<br>└─requests.py<br></code></pre></td></tr></table></figure>
<p>等什么时候手痒痒了再说。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/arcpatch/">对arcaea的部分逆向 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/2.png" alt="Logo"></a><h1 id="Dr"><a href="about/">wsd233</a></h1><div id="description"><p>我的垃圾桶</p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/wsd233"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" href="mailto:abba23333@outlook.com"><i class="fa fa-envelope" alt="E-Mail"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8D%E8%A6%81%E6%B2%A1%E4%BA%8B%E6%89%BE%E4%BA%8B%E3%80%82"><span class="toc-number">1.</span> <span class="toc-text">不要没事找事。</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#M%E5%B1%9E%E6%80%A7%E5%A4%A7%E7%88%86%E5%8F%91"><span class="toc-number">1.1.</span> <span class="toc-text">M属性大爆发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E6%9E%84%E6%80%9D"><span class="toc-number">1.2.</span> <span class="toc-text">初步构思</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8Epython%E6%8A%98%E7%A3%A8%E5%88%B0photoshop%E5%86%8D%E6%8A%98%E7%A3%A8%E5%88%B0python"><span class="toc-number">1.3.</span> <span class="toc-text">从python折磨到photoshop再折磨到python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E5%A4%84%E7%90%86%E9%83%A8%E5%88%86"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">指令处理部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#photoshop%E8%AE%BE%E8%AE%A1%E9%83%A8%E5%88%86"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">photoshop设计部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PIL%E7%BB%98%E5%9B%BE%E9%83%A8%E5%88%86"><span class="toc-number">1.3.0.3.</span> <span class="toc-text">PIL绘图部分</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B8%E6%97%A0%E6%AD%A2%E5%A2%83%E7%9A%84%E6%8A%98%E7%A3%A8"><span class="toc-number">1.4.</span> <span class="toc-text">永无止境的折磨</span></a></li></ol></li></ol></div></div><footer><nobr><span class="icp-title">ICP</span><a class="icp-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">备案个屁</a></nobr><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://ccomments-c2jsxgvkr-wsd233.vercel.app/',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>